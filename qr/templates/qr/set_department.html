{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Departments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
<div class="container mt-5">

  <h2>🏢 Select Company</h2>

  <form method="GET" action="" class="mb-4" style="max-width: 350px;">
    <select name="company" onchange="this.form.submit()" class="form-select">
      <option value="">-- Select Company --</option>
      {% for company in companies %}
        <option value="{{ company.id }}" {% if company.id|stringformat:"s" == selected_company_id %}selected{% endif %}>{{ company.name }}</option>
      {% endfor %}
    </select>
  </form>

  {% if departments %}
    <h3>🏬 Departments in Selected Company</h3>
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for dept in departments %}
        <tr>
          <td><a href="{% url 'qr:department_employees' dept.id %}?company={{ selected_company_id }}">{{ dept.name }}</a></td>
          <td>
            <a href="{% url 'qr:edit_department' dept.id %}" class="btn btn-sm btn-warning">✏️ Edit</a>
            <form method="POST" action="{% url 'qr:delete_department' dept.id %}" style="display:inline;" onsubmit="return confirm('Are you sure?');">
              {% csrf_token %}
              <button class="btn btn-sm btn-danger">🗑 Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="2">No departments found</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% elif selected_company_id %}
    <p class="text-warning">No departments found for this company.</p>
  {% endif %}

  <h4>Add New Department</h4>
  <form method="POST" action="{% url 'qr:add_department' %}" style="max-width: 350px;">
    {% csrf_token %}
    <div class="input-group mb-3">
      <input type="text" class="form-control" name="name" placeholder="Department name" required />
      <button class="btn btn-primary" type="submit">Add</button>
    </div>
  </form>
  
</div>
</body>
</html>
